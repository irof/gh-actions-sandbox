name: タグ作ったらリリース作るやつ

on:
  push:
    tags:
      - 'actions/v*'

jobs:
  draft:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: git fetch --prune --unshallow
      - name: get latest release tagname
        run: |
          latest_tag=$(curl -s https://api.github.com/repos/${GITHUB_REPOSITORY}/releases/latest | jq -r ".tag_name")
          echo ${latest_tag}
          echo "::set-env name=latest_tag::${latest_tag}"
      - name: create release body
        id: get_body
        run: |
          echo ${latest_tag}
          body=$(git log --format="%s" ${latest_tag}..HEAD -- . | awk '{printf $0","}')
          echo ${body}
          echo "::set-output name=body::${body}"
      - name: Create Draft Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Draft ${{ github.ref }}
          body: ${{ steps.get_body.outputs.body }}
          draft: false
          prerelease: false

